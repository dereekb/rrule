!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rrule=e():t.rrule=e()}("undefined"!=typeof self?self:this,function(){return r={},i.m=n=[function(t,e,n){"use strict";n.r(e),n.d(e,"rrulestr",function(){return At}),n.d(e,"Frequency",function(){return C}),n.d(e,"Weekday",function(){return f}),n.d(e,"RRule",function(){return Lt}),n.d(e,"RRuleSet",function(){return jt}),n.d(e,"RRuleError",function(){return rt});var r=["MO","TU","WE","TH","FR","SA","SU"],f=(i.fromStr=function(t){return new i(r.indexOf(t))},i.prototype.nth=function(t){return this.n===t?this:new i(this.weekday,t)},i.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},i.prototype.toString=function(){var t=r[this.weekday];return t=this.n?(0<this.n?"+":"")+String(this.n)+t:t},i.prototype.getJsWeekday=function(){return 6===this.weekday?0:this.weekday+1},i);function i(t,e){if(0===e)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=e}function o(t,e){void 0===e&&(e=t),1===arguments.length&&(e=t,t=0);for(var n=[],r=t;r<e;r++)n.push(r);return n}function m(t,e){var n=0,r=[];if(b(t))for(;n<e;n++)r[n]=[].concat(t);else for(;n<e;n++)r[n]=t;return r}var T=function(t){return null!=t},p=function(t){return"number"==typeof t},h=function(t){return 0<=r.indexOf(t)},b=Array.isArray;function a(t,e,n){void 0===n&&(n=" ");t=String(t);return t.length>(e>>=0)?String(t):((e-=t.length)>n.length&&(n+=m(n,e/n.length)),n.slice(0,e)+String(t))}function d(t,e,n){return t=t.split(e),n?t.slice(0,n).concat([t.slice(n).join(e)]):t}function s(t,e){return{div:Math.floor(t/e),mod:D(t,e)}}var u,y,D=function(t,e){t%=e;return t*e<0?t+e:t},w=function(t){return!T(t)||0===t.length},x=function(t){return!w(t)},O=function(t,e){return x(t)&&-1!==t.indexOf(e)};(y=u=u||{}).MONTH_DAYS=[31,28,31,30,31,30,31,31,30,31,30,31],y.ONE_DAY=864e5,y.MAXYEAR=9999,y.ORDINAL_BASE=new Date(Date.UTC(1970,0,1)),y.PY_WEEKDAYS=[6,0,1,2,3,4,5],y.getYearDay=function(t){var e=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return Math.ceil((e.valueOf()-new Date(t.getUTCFullYear(),0,1).valueOf())/y.ONE_DAY)+1},y.isLeapYear=function(t){return t%4==0&&t%100!=0||t%400==0},y.isDate=function(t){return t instanceof Date},y.isValidDate=function(t){return y.isDate(t)&&!isNaN(t.getTime())},y.tzOffset=function(t){return 60*t.getTimezoneOffset()*1e3},y.daysBetween=function(t,e){t=t.getTime()-y.tzOffset(t),e=e.getTime()-y.tzOffset(e);return Math.round((t-e)/y.ONE_DAY)},y.toOrdinal=function(t){return y.daysBetween(t,y.ORDINAL_BASE)},y.fromOrdinal=function(t){return new Date(y.ORDINAL_BASE.getTime()+t*y.ONE_DAY)},y.getMonthDays=function(t){var e=t.getUTCMonth();return 1===e&&y.isLeapYear(t.getUTCFullYear())?29:y.MONTH_DAYS[e]},y.getWeekday=function(t){return y.PY_WEEKDAYS[t.getUTCDay()]},y.monthRange=function(t,e){e=new Date(Date.UTC(t,e,1));return[y.getWeekday(e),y.getMonthDays(e)]},y.combine=function(t,e){return e=e||t,new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},y.clone=function(t){return new Date(t.getTime())},y.cloneDates=function(t){for(var e=[],n=0;n<t.length;n++)e.push(y.clone(t[n]));return e},y.sort=function(t){t.sort(function(t,e){return t.getTime()-e.getTime()})},y.timeToUntilString=function(t,e){void 0===e&&(e=!0);t=new Date(t);return[a(t.getUTCFullYear().toString(),4,"0"),a(t.getUTCMonth()+1,2,"0"),a(t.getUTCDate(),2,"0"),"T",a(t.getUTCHours(),2,"0"),a(t.getUTCMinutes(),2,"0"),a(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},y.untilStringToDate=function(t){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/.exec(t);if(!e)throw new Error("Invalid UNTIL value: "+t);return new Date(Date.UTC(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10),parseInt(e[5],10)||0,parseInt(e[6],10)||0,parseInt(e[7],10)||0))};var Y=u;function c(t,e){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=e,"between"===t?(this.maxDate=e.inc?e.before:new Date(e.before.getTime()-1),this.minDate=e.inc?e.after:new Date(e.after.getTime()+1)):"before"===t?this.maxDate=e.inc?e.dt:new Date(e.dt.getTime()-1):"after"===t&&(this.minDate=e.inc?e.dt:new Date(e.dt.getTime()+1))}var l=(c.prototype.accept=function(t){++this.total;var e=this.minDate&&t<this.minDate,n=this.maxDate&&t>this.maxDate;if("between"===this.method){if(e)return!0;if(n)return!1}else if("before"===this.method){if(n)return!1}else if("after"===this.method)return!!e||(this.add(t),!1);return this.add(t)},c.prototype.add=function(t){return this._result.push(t),!0},c.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;default:return t.length?t[t.length-1]:null}},c.prototype.clone=function(){return new c(this.method,this.args)},c),g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function v(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var k,E=function(){return(E=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function S(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function U(t,e,n){e=k.call(this,t,e)||this;return e.iterator=n,e}function L(t,e){return-1!==t.indexOf(e)}function M(t){return t.toString()}function _(t,e,n){return e+" "+n+", "+t}var R=(v(U,k=l),U.prototype.add=function(t){return!!this.iterator(t,this._result.length)&&(this._result.push(t),!0)},U),A={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}};function N(t,e,n,r){var i,o;void 0===e&&(e=M),void 0===n&&(n=A),void 0===r&&(r=_),this.text=[],this.language=n||A,this.gettext=e,this.dateFormatter=r,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday&&(i=[].concat(this.options.bymonthday),o=[].concat(this.options.bynmonthday),i.sort(function(t,e){return t-e}),o.sort(function(t,e){return e-t}),this.bymonthday=i.concat(o),this.bymonthday.length||(this.bymonthday=null)),T(this.origOptions.byweekday)?(i=b(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],o=String(i),this.byweekday={allWeeks:i.filter(function(t){return!t.n}),someWeeks:i.filter(function(t){return Boolean(t.n)}),isWeekdays:-1!==o.indexOf("MO")&&-1!==o.indexOf("TU")&&-1!==o.indexOf("WE")&&-1!==o.indexOf("TH")&&-1!==o.indexOf("FR")&&-1===o.indexOf("SA")&&-1===o.indexOf("SU"),isEveryDay:-1!==o.indexOf("MO")&&-1!==o.indexOf("TU")&&-1!==o.indexOf("WE")&&-1!==o.indexOf("TH")&&-1!==o.indexOf("FR")&&-1!==o.indexOf("SA")&&-1!==o.indexOf("SU")},this.byweekday.allWeeks.sort(o=function(t,e){return t.weekday-e.weekday}),this.byweekday.someWeeks.sort(o),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)):this.byweekday=null}var C,I=(N.isFullyConvertible=function(t){if(!(t.options.freq in N.IMPLEMENTED))return!1;if(t.origOptions.until&&t.origOptions.count)return!1;for(var e in t.origOptions){if(L(["dtstart","wkst","freq"],e))return!0;if(!L(N.IMPLEMENTED[t.options.freq],e))return!1}return!0},N.prototype.isFullyConvertible=function(){return N.isFullyConvertible(this.rrule)},N.prototype.toString=function(){var t,e=this.gettext;return this.options.freq in N.IMPLEMENTED?(this.text=[e("every")],this[Pt.FREQUENCIES[this.options.freq]](),this.options.until?(this.add(e("until")),t=this.options.until,this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))):this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time")),this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")):e("RRule error: Unable to fully convert this rrule to text")},N.prototype.HOURLY=function(){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},N.prototype.MINUTELY=function(){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},N.prototype.DAILY=function(){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},N.prototype.WEEKLY=function(){var t=this.gettext;1!==this.options.interval&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?1===this.options.interval?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(1===this.options.interval&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday())},N.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},N.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(1!==this.options.interval&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(1!==this.options.interval&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},N.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},N.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},N.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},N.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},N.prototype.nth=function(t){var e,n;t=parseInt(t.toString(),10);var r=this.gettext;if(-1===t)return r("last");switch(n=Math.abs(t)){case 1:case 21:case 31:e=n+r("st");break;case 2:case 22:e=n+r("nd");break;case 3:case 23:e=n+r("rd");break;default:e=n+r("th")}return t<0?e+" "+r("last"):e},N.prototype.monthtext=function(t){return this.language.monthNames[t-1]},N.prototype.weekdaytext=function(t){var e=p(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[e]},N.prototype.plural=function(t){return t%100!=1},N.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},N.prototype.list=function(t,e,n,r){void 0===r&&(r=","),b(t)||(t=[t]);e=e||function(t){return t.toString()};function i(t){return e&&e.call(o,t)}var o=this;return n?function(t,e,n){for(var r="",i=0;i<t.length;i++)0!==i&&(i===t.length-1?r+=" "+n+" ":r+=e+" "),r+=t[i];return r}(t.map(i),r,n):t.map(i).join(r+" ")},N),W=(j.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},j.prototype.isDone=function(){return this.done&&null===this.symbol},j.prototype.nextSymbol=function(){var t;this.symbol=null,this.value=null;do{if(this.done)return!1;var e,n=null;for(e in this.rules){var r=this.rules[e].exec(this.text);r&&(null===n||r[0].length>n[0].length)&&(n=r,t=e)}if(null!=n&&(this.text=this.text.substr(n[0].length),""===this.text&&(this.done=!0)),null==n)return this.done=!0,this.symbol=null,void(this.value=null)}while("SKIP"===t);return this.symbol=t,this.value=n,!0},j.prototype.accept=function(t){if(this.symbol!==t)return!1;if(this.value){t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0},j.prototype.acceptNumber=function(){return this.accept("number")},j.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},j);function j(t){this.done=!0,this.rules=t}function H(t,e){var a={},s=new W((e=void 0===e?A:e).tokens);return s.start(t)?(function(){s.expect("every");var t=s.acceptNumber();t&&(a.interval=parseInt(t[0],10));if(s.isDone())throw new Error("Unexpected end");switch(s.symbol){case"day(s)":a.freq=Pt.DAILY,s.nextSymbol()&&(function(){if(s.accept("at"))do{var t=s.acceptNumber();if(!t)throw new Error("Unexpected symbol "+s.symbol+", expected hour");for(a.byhour=[parseInt(t[0],10)];s.accept("comma");){if(!(t=s.acceptNumber()))throw new Error("Unexpected symbol "+s.symbol+"; expected hour");a.byhour.push(parseInt(t[0],10))}}while(s.accept("comma")||s.accept("at"))}(),o());break;case"weekday(s)":a.freq=Pt.WEEKLY,a.byweekday=[Pt.MO,Pt.TU,Pt.WE,Pt.TH,Pt.FR],s.nextSymbol(),o();break;case"week(s)":a.freq=Pt.WEEKLY,s.nextSymbol()&&(i(),o());break;case"hour(s)":a.freq=Pt.HOURLY,s.nextSymbol()&&(i(),o());break;case"minute(s)":a.freq=Pt.MINUTELY,s.nextSymbol()&&(i(),o());break;case"month(s)":a.freq=Pt.MONTHLY,s.nextSymbol()&&(i(),o());break;case"year(s)":a.freq=Pt.YEARLY,s.nextSymbol()&&(i(),o());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":a.freq=Pt.WEEKLY;var e=s.symbol.substr(0,2).toUpperCase();if(a.byweekday=[Pt[e]],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var n=h();if(!n)throw new Error("Unexpected symbol "+s.symbol+", expected weekday");a.byweekday.push(Pt[n]),s.nextSymbol()}!function(){s.accept("on"),s.accept("the");var t=y();if(t)for(a.bymonthday=[t],s.nextSymbol();s.accept("comma");){if(!(t=y()))throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");a.bymonthday.push(t),s.nextSymbol()}}(),o();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(a.freq=Pt.YEARLY,a.bymonth=[u()],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var r=u();if(!r)throw new Error("Unexpected symbol "+s.symbol+", expected month");a.bymonth.push(r),s.nextSymbol()}i(),o();break;default:throw new Error("Unknown symbol")}}(),a):null;function i(){var t=s.accept("on"),e=s.accept("the");if(t||e)do{var n=y(),r=h(),i=u();if(n)r?(s.nextSymbol(),a.byweekday||(a.byweekday=[]),a.byweekday.push(Pt[r].nth(n))):(a.bymonthday||(a.bymonthday=[]),a.bymonthday.push(n),s.accept("day(s)"));else if(r)s.nextSymbol(),a.byweekday||(a.byweekday=[]),a.byweekday.push(Pt[r]);else if("weekday(s)"===s.symbol)s.nextSymbol(),a.byweekday||(a.byweekday=[Pt.MO,Pt.TU,Pt.WE,Pt.TH,Pt.FR]);else if("week(s)"===s.symbol){s.nextSymbol();var o=s.acceptNumber();if(!o)throw new Error("Unexpected symbol "+s.symbol+", expected week number");for(a.byweekno=[parseInt(o[0],10)];s.accept("comma");){if(!(o=s.acceptNumber()))throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");a.byweekno.push(parseInt(o[0],10))}}else{if(!i)return;s.nextSymbol(),a.bymonth||(a.bymonth=[]),a.bymonth.push(i)}}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function u(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function h(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function y(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":var t=parseInt(s.value[1],10);if(t<-366||366<t)throw new Error("Nth out of range: "+t);return s.nextSymbol(),s.accept("last")?-t:t;default:return!1}}function o(){if("until"===s.symbol){var t=Date.parse(s.text);if(!t)throw new Error("Cannot parse until date:"+s.text);a.until=new Date(t)}else s.accept("for")&&(a.count=parseInt(s.value[0],10),s.expect("number"))}}function z(t){return t<C.HOURLY}
/*!
* rrule.js - Library for working with recurrence rules for calendar dates.
* https://github.com/jakubroztocil/rrule
*
* Copyright 2010, Jakub Roztocil and Lars Schoning
* Licenced under the BSD licence.
* https://github.com/jakubroztocil/rrule/blob/master/LICENCE
*
*/(ct=C=C||{})[ct.YEARLY=0]="YEARLY",ct[ct.MONTHLY=1]="MONTHLY",ct[ct.WEEKLY=2]="WEEKLY",ct[ct.DAILY=3]="DAILY",ct[ct.HOURLY=4]="HOURLY",ct[ct.MINUTELY=5]="MINUTELY",ct[ct.SECONDLY=6]="SECONDLY";var q=["count","until","interval","byweekday","bymonthday","bymonth"];I.IMPLEMENTED=[],I.IMPLEMENTED[C.HOURLY]=q,I.IMPLEMENTED[C.MINUTELY]=q,I.IMPLEMENTED[C.DAILY]=["byhour"].concat(q),I.IMPLEMENTED[C.WEEKLY]=q,I.IMPLEMENTED[C.MONTHLY]=q,I.IMPLEMENTED[C.YEARLY]=["byweekno","byyearday"].concat(q);var P=I.isFullyConvertible,F=(K.prototype.getHours=function(){return this.hour},K.prototype.getMinutes=function(){return this.minute},K.prototype.getSeconds=function(){return this.second},K.prototype.getMilliseconds=function(){return this.millisecond},K.prototype.getTime=function(){return 1e3*(60*this.hour*60+60*this.minute+this.second)+this.millisecond},K);function K(t,e,n,r){this.hour=t,this.minute=e,this.second=n,this.millisecond=r||0}var B,Z=(v(V,B=F),V.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},V.prototype.getWeekday=function(){return u.getWeekday(new Date(this.getTime()))},V.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},V.prototype.getDay=function(){return this.day},V.prototype.getMonth=function(){return this.month},V.prototype.getYear=function(){return this.year},V.prototype.addYears=function(t){this.year+=t},V.prototype.addMonths=function(t){var e;this.month+=t,12<this.month&&(e=Math.floor(this.month/12),t=D(this.month,12),this.month=t,this.year+=e,0===this.month&&(this.month=12,--this.year))},V.prototype.addWeekly=function(t,e){e>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-e))+7*t:this.day+=-(this.getWeekday()-e)+7*t,this.fixDay()},V.prototype.addDaily=function(t){this.day+=t,this.fixDay()},V.prototype.addHours=function(t,e,n){for(e&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var r=s(this.hour,24),i=r.div,r=r.mod;if(i&&(this.hour=r,this.addDaily(i)),w(n)||O(n,this.hour))break}},V.prototype.addMinutes=function(t,e,n,r){for(e&&(this.minute+=Math.floor((1439-(60*this.hour+this.minute))/t)*t);;){this.minute+=t;var i=s(this.minute,60),o=i.div,i=i.mod;if(o&&(this.minute=i,this.addHours(o,!1,n)),(w(n)||O(n,this.hour))&&(w(r)||O(r,this.minute)))break}},V.prototype.addSeconds=function(t,e,n,r,i){for(e&&(this.second+=Math.floor((86399-(3600*this.hour+60*this.minute+this.second))/t)*t);;){this.second+=t;var o=s(this.second,60),a=o.div,o=o.mod;if(a&&(this.second=o,this.addMinutes(a,!1,n,r)),(w(n)||O(n,this.hour))&&(w(r)||O(r,this.minute))&&(w(i)||O(i,this.second)))break}},V.prototype.fixDay=function(){if(!(this.day<=28)){var t=u.monthRange(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,13===this.month&&(this.month=1,++this.year,this.year>u.MAXYEAR))return;t=u.monthRange(this.year,this.month-1)[1]}}},V.prototype.add=function(t,e){var n=t.freq,r=t.interval,i=t.wkst,o=t.byhour,a=t.byminute,s=t.bysecond;switch(n){case C.YEARLY:return this.addYears(r);case C.MONTHLY:return this.addMonths(r);case C.WEEKLY:return this.addWeekly(r,i);case C.DAILY:return this.addDaily(r);case C.HOURLY:return this.addHours(r,e,o);case C.MINUTELY:return this.addMinutes(r,e,o,a);case C.SECONDLY:return this.addSeconds(r,e,o,a,s)}},V);function V(t,e,n,r,i,o,a){a=B.call(this,r,i,o,a)||this;return a.year=t,a.month=e,a.day=n,a}function X(t){for(var e=[],n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];O(St,i)||e.push(i),Y.isDate(t[i])&&!Y.isValidDate(t[i])&&e.push(i)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return E({},t)}function G(t){t=t.split("\n").map(Q).filter(function(t){return null!==t});return E(E({},t[0]),t[1])}function J(t){var e={},n=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(t);if(!n)return e;n[0];t=n[1],n=n[2];return t&&(e.tzid=t),e.dtstart=Y.untilStringToDate(n),e}function Q(t){if(!(t=t.replace(/^\s+|\s+$/,"")).length)return null;var e=/^([A-Z]+?)[:;]/.exec(t.toUpperCase());if(!e)return $(t);e[0];var n=e[1];switch(n.toUpperCase()){case"RRULE":case"EXRULE":return $(t);case"DTSTART":return J(t);default:throw new Error("Unsupported RFC prop "+n+" in "+t)}}function $(o){var a=J(o.replace(/^RRULE:/i,""));return o.replace(/^(?:RRULE|EXRULE):/i,"").split(";").forEach(function(t){var t=t.split("="),e=t[0],n=t[1];switch(e.toUpperCase()){case"FREQ":a.freq=C[n.toUpperCase()];break;case"WKST":a.wkst=Ot[n.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var r=-1===(i=n).indexOf(",")?tt(i):i.split(",").map(tt),i=e.toLowerCase();a[i]=r;break;case"BYWEEKDAY":case"BYDAY":a.byweekday=n.split(",").map(function(t){if(2===t.length)return Ot[t];var e=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/),t=Number(e[1]),e=e[2],e=Ot[e].weekday;return new f(e,t)});break;case"DTSTART":case"TZID":r=J(o);a.tzid=r.tzid,a.dtstart=r.dtstart;break;case"UNTIL":a.until=Y.untilStringToDate(n);break;case"BYEASTER":a.byeaster=Number(n);break;default:throw new Error("Unknown RRULE property '"+e+"'")}}),a}function tt(t){return/^[+-]?\d+$/.test(t)?Number(t):t}var et=function(){throw new TypeError};function nt(){}var rt=(nt.logLuxonTzidError=function(t){this.emitLuxonTzidError&&console.error("Using TZID without Luxon available is unsupported. Returned times are in UTC, not the requested time zone")},nt.emitLuxonTzidError=!0,nt),it=(Object.defineProperty(ot.prototype,"isUTC",{get:function(){return!this.tzid||"UTC"===this.tzid.toUpperCase()},enumerable:!1,configurable:!0}),ot.prototype.toString=function(){var t=Y.timeToUntilString(this.date.getTime(),this.isUTC);return this.isUTC?":"+t:";TZID="+this.tzid+":"+t},ot.prototype.getTime=function(){return this.date.getTime()},ot.prototype.rezonedDate=function(){if(this.isUTC)return this.date;try{return et(this.date).setZone(this.tzid,{keepLocalTime:!0}).toJSDate()}catch(t){return t instanceof TypeError&&rt.logLuxonTzidError(t),this.date}},ot);function ot(t,e){this.date=t,this.tzid=e}function at(t){for(var e,n,r=[],i="",o=Object.keys(t),a=Object.keys(Yt),s=0;s<o.length;s++)if("tzid"!==o[s]&&O(a,o[s])){var u=o[s].toUpperCase(),h=t[o[s]],y="";if(T(h)&&(!b(h)||h.length)){switch(u){case"FREQ":y=Lt.FREQUENCIES[t.freq];break;case"WKST":y=(p(h)?new f(h):h).toString();break;case"BYWEEKDAY":u="BYDAY",y=(b(n=h)?n:[n]).map(function(t){return t instanceof f?t:b(t)?new f(t[0],t[1]):new f(t)}).toString();break;case"DTSTART":e=h,n=t.tzid,i=e?"DTSTART"+new it(new Date(e),n).toString():"";break;case"UNTIL":y=Y.timeToUntilString(h,!t.tzid);break;default:if(b(h)){for(var d=[],c=0;c<h.length;c++)d[c]=String(h[c]);y=d.toString()}else y=String(h)}y&&r.push([u,y])}}var l=r.map(function(t){return t[0]+"="+t[1].toString()}).join(";");return[i,""!==l?"RRULE:"+l:""].filter(function(t){return!!t}).join("\n")}var st=(ut.prototype._cacheAdd=function(t,e,n){e=e&&(e instanceof Date?Y.clone(e):Y.cloneDates(e)),"all"===t?this.all=e:(n._value=e,this[t].push(n))},ut.prototype._cacheGet=function(t,r){function e(t){for(var e=0;e<i.length;e++){var n=i[e];if(!function(t,n){return Array.isArray(t)?Array.isArray(n)&&(t.length===n.length&&t.every(function(t,e){return t.getTime()===n[e].getTime()})):t instanceof Date?n instanceof Date&&t.getTime()===n.getTime():t===n}(r[n],t[n]))return 1}}var n=!1,i=r?Object.keys(r):[],o=this[t];if("all"===t)n=this.all;else if(b(o))for(var a=0;a<o.length;a++){var s=o[a];if(!i.length||!e(s)){n=s._value;break}}if(!n&&this.all){for(var u=new l(t,r),a=0;a<this.all.length&&u.accept(this.all[a]);a++);n=u.getValue(),this._cacheAdd(t,n,r)}return b(n)?Y.cloneDates(n):n instanceof Date?Y.clone(n):n},ut);function ut(){this.all=!1,this.before=[],this.after=[],this.between=[]}var ht=S(m(1,31),m(2,28),m(3,31),m(4,30),m(5,31),m(6,30),m(7,31),m(8,31),m(9,30),m(10,31),m(11,30),m(12,31),m(1,7)),yt=S(m(1,31),m(2,29),m(3,31),m(4,30),m(5,31),m(6,30),m(7,31),m(8,31),m(9,30),m(10,31),m(11,30),m(12,31),m(1,7)),dt=o(1,29),n=o(1,30),ct=o(1,31),q=o(1,32),lt=S(q,n,q,ct,q,ct,q,q,ct,q,ct,q,q.slice(0,7)),ft=S(q,dt,q,ct,q,ct,q,q,ct,q,ct,q,q.slice(0,7)),n=o(-28,0),dt=o(-29,0),ct=o(-30,0),q=o(-31,0),pt=S(q,dt,q,ct,q,ct,q,q,ct,q,ct,q,q.slice(0,7)),mt=S(q,n,q,ct,q,ct,q,q,ct,q,ct,q,q.slice(0,7)),bt=[0,31,60,91,121,152,182,213,244,274,305,335,366],wt=[0,31,59,90,120,151,181,212,243,273,304,334,365],gt=function(){for(var t=[],e=0;e<55;e++)t=t.concat(o(7));return t}();function vt(t,e){var n,r=new Date(Date.UTC(t,0,1)),i=Y.isLeapYear(t)?366:365,o=Y.isLeapYear(t+1)?366:365,a=Y.toOrdinal(r),s=Y.getWeekday(r),u=E(E({yearlen:i,nextyearlen:o,yearordinal:a,yearweekday:s},(r=t,o=Y.isLeapYear(r)?366:365,r=new Date(Date.UTC(r,0,1)),r=Y.getWeekday(r),365!=o?{mmask:yt,mdaymask:lt,nmdaymask:pt,wdaymask:gt.slice(r),mrange:bt}:{mmask:ht,mdaymask:ft,nmdaymask:mt,wdaymask:gt.slice(r),mrange:wt})),{wnomask:null});if(w(e.byweekno))return u;u.wnomask=m(0,7+i);for(var h=n=D(7-s+e.wkst,7),a=4<=h?(h=0,u.yearlen+D(s-e.wkst,7)):i-h,o=Math.floor(a/7),r=D(a,7),y=Math.floor(o+r/4),d=0;d<e.byweekno.length;d++){var c=e.byweekno[d];if(c<0&&(c+=y+1),0<c&&c<=y){var l=void 0;1<c?(l=h+7*(c-1),h!==n&&(l-=7-n)):l=h;for(var f=0;f<7&&(u.wnomask[l]=1,l++,u.wdaymask[l]!==e.wkst);f++);}}if(O(e.byweekno,1)){l=h+7*y;if(h!==n&&(l-=7-n),l<i)for(d=0;d<7&&(l+=u.wnomask[l]=1,u.wdaymask[l]!==e.wkst);d++);}if(h){var s=void 0;if(s=O(e.byweekno,-1)?-1:(a=Y.getWeekday(new Date(Date.UTC(t-1,0,1))),o=D(7-a.valueOf()+e.wkst,7),r=Y.isLeapYear(t-1)?366:365,t=void 0,t=4<=o?r+D(a-e.wkst,7):i-h,Math.floor(52+D(t,7)/4)),O(e.byweekno,s))for(l=0;l<h;l++)u.wnomask[l]=1}return u}function kt(t){this.options=t}var Et=(kt.prototype.rebuild=function(t,e){var n,r,i,o=this.options;t!==this.lastyear&&(this.yearinfo=vt(t,o)),!x(o.bynweekday)||e===this.lastmonth&&t===this.lastyear||(n=(i=this.yearinfo).yearlen,r=i.mrange,i=i.wdaymask,this.monthinfo=function(t,e,n,r,i,o){var a={lastyear:t,lastmonth:e,nwdaymask:[]},s=[];if(o.freq===Lt.YEARLY)if(w(o.bymonth))s=[[0,n]];else for(var u=0;u<o.bymonth.length;u++)e=o.bymonth[u],s.push(r.slice(e-1,e+1));else o.freq===Lt.MONTHLY&&(s=[r.slice(e-1,e+1)]);if(w(s))return a;for(a.nwdaymask=m(0,n),u=0;u<s.length;u++)for(var h=s[u],y=h[0],d=h[1]-1,c=0;c<o.bynweekday.length;c++){var l=void 0,f=o.bynweekday[c],p=f[0],f=f[1];f<0?(l=d+7*(f+1),l-=D(i[l]-p,7)):(l=y+7*(f-1),l+=D(7-i[l]+p,7)),y<=l&&l<=d&&(a.nwdaymask[l]=1)}return a}(t,e,n,r,i,o)),T(o.byeaster)&&(this.eastermask=function(t,e){void 0===e&&(e=0);var n=t%19,r=Math.floor(t/100),i=t%100,o=Math.floor(r/4),a=r%4,s=Math.floor((r+8)/25),s=Math.floor((r-s+1)/3),o=Math.floor(19*n+r-o-s+15)%30,s=Math.floor(i/4),s=Math.floor(32+2*a+2*s-o-i%4)%7,i=Math.floor((n+11*o+22*s)/451),n=Math.floor((o+s-7*i+114)/31),e=Date.UTC(t,n-1,(o+s-7*i+114)%31+1+e),t=Date.UTC(t,0,1);return[Math.ceil((e-t)/864e5)]}(t,o.byeaster))},Object.defineProperty(kt.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(kt.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),kt.prototype.ydayset=function(){return[o(this.yearlen),0,this.yearlen]},kt.prototype.mdayset=function(t,e,n){for(var r=this.mrange[e-1],i=this.mrange[e],o=m(null,this.yearlen),a=r;a<i;a++)o[a]=a;return[o,r,i]},kt.prototype.wdayset=function(t,e,n){for(var r=m(null,this.yearlen+7),i=Y.toOrdinal(new Date(Date.UTC(t,e-1,n)))-this.yearordinal,n=i,o=0;o<7&&(r[i]=i,this.wdaymask[++i]!==this.options.wkst);o++);return[r,n,i]},kt.prototype.ddayset=function(t,e,n){var r=m(null,this.yearlen),n=Y.toOrdinal(new Date(Date.UTC(t,e-1,n)))-this.yearordinal;return r[n]=n,[r,n,1+n]},kt.prototype.htimeset=function(e,t,n,r){var i=this,o=[];return this.options.byminute.forEach(function(t){o=o.concat(i.mtimeset(e,t,n,r))}),Y.sort(o),o},kt.prototype.mtimeset=function(e,n,t,r){var i=this.options.bysecond.map(function(t){return new F(e,n,t,r)});return Y.sort(i),i},kt.prototype.stimeset=function(t,e,n,r){return[new F(t,e,n,r)]},kt.prototype.getdayset=function(t){switch(t){case C.YEARLY:return this.ydayset.bind(this);case C.MONTHLY:return this.mdayset.bind(this);case C.WEEKLY:return this.wdayset.bind(this);default:C.DAILY;return this.ddayset.bind(this)}},kt.prototype.gettimeset=function(t){switch(t){case C.HOURLY:return this.htimeset.bind(this);case C.MINUTELY:return this.mtimeset.bind(this);case C.SECONDLY:return this.stimeset.bind(this)}},kt);function Tt(t,e){var n=e.dtstart,r=e.freq,i=e.interval,o=e.until,a=e.bysetpos,s=e.count;if(0===s||0===i)return xt(t);var u=Z.fromDate(n),h=new Et(e);h.rebuild(u.year,u.month);for(var y=function(t,e,n){var r=n.freq,i=n.byhour,o=n.byminute,a=n.bysecond;if(z(r))return function(t){var r=t.dtstart.getTime()%1e3;if(!z(t.freq))return[];var i=[];return t.byhour.forEach(function(n){t.byminute.forEach(function(e){t.bysecond.forEach(function(t){i.push(new F(n,e,t,r))})})}),i}(n);if(r>=Lt.HOURLY&&x(i)&&!O(i,e.hour)||r>=Lt.MINUTELY&&x(o)&&!O(o,e.minute)||r>=Lt.SECONDLY&&x(a)&&!O(a,e.second))return[];return t.gettimeset(r)(e.hour,e.minute,e.second,e.millisecond)}(h,u,e);;){var d=h.getdayset(r)(u.year,u.month,u.day),c=d[0],l=d[1],f=d[2],d=function(t,e,n,r,i){for(var o=!1,a=e;a<n;a++){var s=t[a];(o=function(t,e,n){var r=n.bymonth,i=n.byweekno,o=n.byweekday,a=n.byeaster,s=n.bymonthday,u=n.bynmonthday,n=n.byyearday;return x(r)&&!O(r,t.mmask[e])||x(i)&&!t.wnomask[e]||x(o)&&!O(o,t.wdaymask[e])||x(t.nwdaymask)&&!t.nwdaymask[e]||null!==a&&!O(t.eastermask,e)||(x(s)||x(u))&&!O(s,t.mdaymask[e])&&!O(u,t.nmdaymask[e])||x(n)&&(e<t.yearlen&&!O(n,e+1)&&!O(n,-t.yearlen+e)||e>=t.yearlen&&!O(n,e+1-t.yearlen)&&!O(n,-t.nextyearlen+e-t.yearlen))}(r,s,i))&&(t[s]=null)}return o}(c,l,f,h,e);if(x(a))for(var p=function(t,e,n,r,i,o){for(var a=[],s=0;s<t.length;s++){for(var u=void 0,h=void 0,y=t[s],h=y<0?(u=Math.floor(y/e.length),D(y,e.length)):(u=Math.floor((y-1)/e.length),D(y-1,e.length)),d=[],c=n;c<r;c++){var l=o[c];T(l)&&d.push(l)}y=void 0,y=u<0?d.slice(u)[0]:d[u],h=e[h],y=Y.fromOrdinal(i.yearordinal+y),h=Y.combine(y,h);O(a,h)||a.push(h)}return Y.sort(a),a}(a,y,l,f,h,c),m=0;m<p.length;m++){var b=p[m];if(o&&o<b)return xt(t);if(n<=b){var w=Dt(b,e);if(!t.accept(w))return xt(t);if(s&&!--s)return xt(t)}}else for(m=l;m<f;m++){var g=c[m];if(T(g))for(var v=Y.fromOrdinal(h.yearordinal+g),k=0;k<y.length;k++){var E=y[k],b=Y.combine(v,E);if(o&&o<b)return xt(t);if(n<=b){w=Dt(b,e);if(!t.accept(w))return xt(t);if(s&&!--s)return xt(t)}}}if(0===e.interval)return xt(t);if(u.add(e,d),u.year>Y.MAXYEAR)return xt(t);z(r)||(y=h.gettimeset(r)(u.hour,u.minute,u.second,0)),h.rebuild(u.year,u.month)}}function Dt(t,e){return new it(t,e.tzid).rezonedDate()}function xt(t){return t.getValue()}var Ot={MO:new f(0),TU:new f(1),WE:new f(2),TH:new f(3),FR:new f(4),SA:new f(5),SU:new f(6)},Yt={freq:C.YEARLY,dtstart:null,interval:1,wkst:Ot.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},St=Object.keys(Yt);function Ut(t,e){void 0===t&&(t={}),this._cache=(e=void 0===e?!1:e)?null:new st,this.origOptions=X(t);t=function(t){var e=E(E({},Yt),X(t));if(T(e.byeaster)&&(e.freq=Lt.YEARLY),!T(e.freq)||!Lt.FREQUENCIES[e.freq])throw new Error("Invalid frequency: "+e.freq+" "+t.freq);if(e.dtstart||(e.dtstart=new Date((new Date).setMilliseconds(0))),T(e.wkst)?p(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=Lt.MO.weekday,T(e.bysetpos)){p(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var n=0;n<e.bysetpos.length;n++)if(0===(r=e.bysetpos[n])||!(-366<=r&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}if(!(Boolean(e.byweekno)||x(e.byweekno)||x(e.byyearday)||Boolean(e.bymonthday)||x(e.bymonthday)||T(e.byweekday)||T(e.byeaster)))switch(e.freq){case Lt.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case Lt.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case Lt.WEEKLY:e.byweekday=[Y.getWeekday(e.dtstart)]}if(T(e.bymonth)&&!b(e.bymonth)&&(e.bymonth=[e.bymonth]),T(e.byyearday)&&!b(e.byyearday)&&p(e.byyearday)&&(e.byyearday=[e.byyearday]),T(e.bymonthday))if(b(e.bymonthday)){for(var r,i=[],o=[],n=0;n<e.bymonthday.length;n++)0<(r=e.bymonthday[n])?i.push(r):r<0&&o.push(r);e.bymonthday=i,e.bynmonthday=o}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);else e.bymonthday=[],e.bynmonthday=[];if(T(e.byweekno)&&!b(e.byweekno)&&(e.byweekno=[e.byweekno]),T(e.byweekday))if(p(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(h(e.byweekday))e.byweekday=[f.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof f)!e.byweekday.n||e.freq>Lt.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var a=[],s=[],n=0;n<e.byweekday.length;n++){var u=e.byweekday[n];p(u)?a.push(u):h(u)?a.push(f.fromStr(u).weekday):!u.n||e.freq>Lt.MONTHLY?a.push(u.weekday):s.push([u.weekday,u.n])}e.byweekday=x(a)?a:null,e.bynweekday=x(s)?s:null}else e.bynweekday=null;return T(e.byhour)?p(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<Lt.HOURLY?[e.dtstart.getUTCHours()]:null,T(e.byminute)?p(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<Lt.MINUTELY?[e.dtstart.getUTCMinutes()]:null,T(e.bysecond)?p(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<Lt.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}(t).parsedOptions;this.options=t}var Lt=(Ut.parseText=H,Ut.fromText=function(t,e){return new Pt(H(t,e=void 0===(e=e)?A:e)||void 0)},Ut.fromString=function(t){return new Ut(Ut.parseString(t)||void 0)},Ut.prototype._iter=function(t){return Tt(t,this.options)},Ut.prototype._cacheGet=function(t,e){return!!this._cache&&this._cache._cacheGet(t,e)},Ut.prototype._cacheAdd=function(t,e,n){if(this._cache)return this._cache._cacheAdd(t,e,n)},Ut.prototype.all=function(t){if(t)return this._iter(new R("all",{},t));t=this._cacheGet("all");return!1===t&&(t=this._iter(new l("all",{})),this._cacheAdd("all",t)),t},Ut.prototype.between=function(t,e,n,r){if(void 0===n&&(n=!1),!Y.isValidDate(t)||!Y.isValidDate(e))throw new Error("Invalid date passed in to RRule.between");n={before:e,after:t,inc:n};if(r)return this._iter(new R("between",n,r));r=this._cacheGet("between",n);return!1===r&&(r=this._iter(new l("between",n)),this._cacheAdd("between",r,n)),r},Ut.prototype.before=function(t,e){if(void 0===e&&(e=!1),!Y.isValidDate(t))throw new Error("Invalid date passed in to RRule.before");t={dt:t,inc:e},e=this._cacheGet("before",t);return!1===e&&(e=this._iter(new l("before",t)),this._cacheAdd("before",e,t)),e},Ut.prototype.after=function(t,e){if(void 0===e&&(e=!1),!Y.isValidDate(t))throw new Error("Invalid date passed in to RRule.after");t={dt:t,inc:e},e=this._cacheGet("after",t);return!1===e&&(e=this._iter(new l("after",t)),this._cacheAdd("after",e,t)),e},Ut.prototype.count=function(){return this.all().length},Ut.prototype.toString=function(){return at(this.origOptions)},Ut.prototype.toText=function(t,e,n){return new I(this,t,e,n).toString()},Ut.prototype.isFullyConvertibleToText=function(){return P(this)},Ut.prototype.clone=function(){return new Ut(this.origOptions)},Ut.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],Ut.YEARLY=C.YEARLY,Ut.MONTHLY=C.MONTHLY,Ut.WEEKLY=C.WEEKLY,Ut.DAILY=C.DAILY,Ut.HOURLY=C.HOURLY,Ut.MINUTELY=C.MINUTELY,Ut.SECONDLY=C.SECONDLY,Ut.MO=Ot.MO,Ut.TU=Ot.TU,Ut.WE=Ot.WE,Ut.TH=Ot.TH,Ut.FR=Ot.FR,Ut.SA=Ot.SA,Ut.SU=Ot.SU,Ut.parseString=G,Ut.optionsToString=at,Ut);var Mt,_t={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function Rt(t,e){var a=[],s=[],u=[],h=[],n=J(t),r=n.dtstart,y=n.tzid;return function(t,e){void 0===e&&(e=!1);if(!(t=t&&t.trim()))throw new Error("Invalid empty string");if(!e)return t.split(/\s/);var n=t.split("\n"),r=0;for(;r<n.length;){var i=n[r]=n[r].replace(/\s+$/g,"");i?0<r&&" "===i[0]?(n[r-1]+=i.slice(1),n.splice(r,1)):r+=1:n.splice(r,1)}return n}(t,e.unfold).forEach(function(t){if(t){var e=function(t){var e=function(t){if(-1===t.indexOf(":"))return{name:"RRULE",value:t};var e=d(t,":",1),t=e[0],e=e[1];return{name:t,value:e}}(t),t=e.name,e=e.value,t=t.split(";");if(!t)throw new Error("empty property name");return{name:t[0].toUpperCase(),parms:t.slice(1),value:e}}(t),n=e.name,r=e.parms,i=e.value;switch(n.toUpperCase()){case"RRULE":if(r.length)throw new Error("unsupported RRULE parm: "+r.join(","));a.push(G(t));break;case"RDATE":var o=/RDATE(?:;TZID=([^:=]+))?/i.exec(t),o=(o[0],o[1]);o&&!y&&(y=o),s=s.concat(Ct(i,r));break;case"EXRULE":if(r.length)throw new Error("unsupported EXRULE parm: "+r.join(","));u.push(G(i));break;case"EXDATE":h=h.concat(Ct(i,r));break;case"DTSTART":break;default:throw new Error("unsupported property: "+n)}}}),{dtstart:r,tzid:y,rrulevals:a,rdatevals:s,exrulevals:u,exdatevals:h}}function At(t,e){return function(t,e){var n=Rt(t,e),r=n.rrulevals,i=n.rdatevals,o=n.exrulevals,t=n.exdatevals,a=n.dtstart,s=n.tzid,u=!1===e.cache;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||1<r.length||i.length||o.length||t.length){var h=new jt(u);return h.dtstart(a),h.tzid(s||void 0),r.forEach(function(t){h.rrule(new Lt(Nt(t,a,s),u))}),i.forEach(function(t){h.rdate(t)}),o.forEach(function(t){h.exrule(new Lt(Nt(t,a,s),u))}),t.forEach(function(t){h.exdate(t)}),e.compatible&&e.dtstart&&h.rdate(a),h}return r=r[0]||{},new Lt(Nt(r,r.dtstart||e.dtstart||a,r.tzid||e.tzid||s),u)}(t,function(t){var e=[],n=Object.keys(t),r=Object.keys(_t);if(n.forEach(function(t){O(r,t)||e.push(t)}),e.length)throw new Error("Invalid options: "+e.join(", "));return E(E({},_t),t)}(e=void 0===e?{}:e))}function Nt(t,e,n){return E(E({},t),{dtstart:e,tzid:n})}function Ct(t,e){return e.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)}),t.split(",").map(function(t){return Y.untilStringToDate(t)})}function It(r){var i=this;return function(t){if(void 0!==t&&(i["_"+r]=t),void 0!==i["_"+r])return i["_"+r];for(var e=0;e<i._rrule.length;e++){var n=i._rrule[e].origOptions[r];if(n)return n}}}function Wt(t){t=Mt.call(this,{},t=void 0===t?!1:t)||this;return t.dtstart=It.apply(t,["dtstart"]),t.tzid=It.apply(t,["tzid"]),t._rrule=[],t._rdate=[],t._exrule=[],t._exdate=[],t}var jt=(v(Wt,Mt=Lt),Wt.prototype._iter=function(t){return function(e,t,r,n,i,o){var a={},s=e.accept;function u(e,n){r.forEach(function(t){t.between(e,n,!0).forEach(function(t){a[Number(t)]=!0})})}i.forEach(function(t){t=new it(t,o).rezonedDate();a[Number(t)]=!0}),e.accept=function(t){var e=Number(t);return isNaN(e)?s.call(this,t):!(!a[e]&&(u(new Date(e-1),new Date(e+1)),!a[e]))||(a[e]=!0,s.call(this,t))},"between"===e.method&&(u(e.args.after,e.args.before),e.accept=function(t){var e=Number(t);return!!a[e]||(a[e]=!0,s.call(this,t))});for(var h=0;h<n.length;h++){var y=new it(n[h],o).rezonedDate();if(!e.accept(new Date(y.getTime())))break}t.forEach(function(t){Tt(e,t.options)});var d=e._result;switch(Y.sort(d),e.method){case"all":case"between":return d;case"before":return d.length&&d[d.length-1]||null;default:return d.length&&d[0]||null}}(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},Wt.prototype.rrule=function(t){Ht(t,this._rrule)},Wt.prototype.exrule=function(t){Ht(t,this._exrule)},Wt.prototype.rdate=function(t){zt(t,this._rdate)},Wt.prototype.exdate=function(t){zt(t,this._exdate)},Wt.prototype.rrules=function(){return this._rrule.map(function(t){return At(t.toString())})},Wt.prototype.exrules=function(){return this._exrule.map(function(t){return At(t.toString())})},Wt.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},Wt.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},Wt.prototype.valueOf=function(){var e=[];return!this._rrule.length&&this._dtstart&&(e=e.concat(at({dtstart:this._dtstart}))),this._rrule.forEach(function(t){e=e.concat(t.toString().split("\n"))}),this._exrule.forEach(function(t){e=e.concat(t.toString().split("\n").map(function(t){return t.replace(/^RRULE:/,"EXRULE:")}).filter(function(t){return!/^DTSTART/.test(t)}))}),this._rdate.length&&e.push(qt("RDATE",this._rdate,this.tzid())),this._exdate.length&&e.push(qt("EXDATE",this._exdate,this.tzid())),e},Wt.prototype.toString=function(){return this.valueOf().join("\n")},Wt.prototype.clone=function(){var e=new Wt(!!this._cache);return this._rrule.forEach(function(t){return e.rrule(t.clone())}),this._exrule.forEach(function(t){return e.exrule(t.clone())}),this._rdate.forEach(function(t){return e.rdate(new Date(t.getTime()))}),this._exdate.forEach(function(t){return e.exdate(new Date(t.getTime()))}),e},Wt);function Ht(t,e){if(!(t instanceof Lt))throw new TypeError(String(t)+" is not RRule instance");O(e.map(String),String(t))||e.push(t)}function zt(t,e){if(!(t instanceof Date))throw new TypeError(String(t)+" is not Date instance");O(e.map(Number),Number(t))||(e.push(t),Y.sort(e))}function qt(t,e,n){var r=!n||"UTC"===n.toUpperCase();return(r?t+":":t+";TZID="+n+":")+e.map(function(t){return Y.timeToUntilString(t.valueOf(),r)}).join(",")}
/*!
 * rrule.js - Library for working with recurrence rules for calendar dates.
 * https://github.com/jakubroztocil/rrule
 *
 * Copyright 2010, Jakub Roztocil and Lars Schoning
 * Licenced under the BSD licence.
 * https://github.com/jakubroztocil/rrule/blob/master/LICENCE
 *
 * Based on:
 * python-dateutil - Extensions to the standard Python datetime module.
 * Copyright (c) 2003-2011 - Gustavo Niemeyer <gustavo@niemeyer.net>
 * Copyright (c) 2012 - Tomi Pieviläinen <tomi.pievilainen@iki.fi>
 * https://github.com/jakubroztocil/rrule/blob/master/LICENCE
 *
 */var Pt=e.default=Lt}],i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0);function i(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,r});